\chapter{Discussion}\label{sec:discussion}

\epigraph{Your scientists were so preoccupied with whether they could, they didn't stop to think if they should.}{Dr.~Ian Malcolm}

The following wil analyze the \Nref{sec:results} in light of what they achieve and evaluate the
fesability of the \hefe~approach in comparison to other methods.

% Fokus her: Hefes value add
% \section{Dette kontra tradisjonell generering}
\section{Scenario modification versus scenario generation}
% TODO: Vil legge inn noe om concept blending her for å forsvare å ha det med i background
% En LLM genererer et scenario ved å concept blende

This project concerns itself with taking existing scenarios and \emph{modifying} them. This is in
many ways similar to scenario \emph{generation}, but there are also certain key differences. Let us
review some of these.

% TODO: Gir det mening å ha dette som en subsection når det bare er én i seksjonen?
\subsection{Unknown substrate}

When generating a new scenario, the principal factor in determining what it will contain, is a
combination of your generation technique, and what sort of training data you will have used for
obtaining this technique. As such, you might not always have complete control of what underlying
data will be used for the generation of your specific scenario.

With the \hefe~approach wherein the user provides a base scenario themself, there is \num{100}\%
certainty of what the base scenario will be. Thus, we obtain significant inherent knowledge of the
scenario substrate\footnote{Assuming of course that the user \emph{has} this knowledge of their base
    secnario.}. Naturally, you may object, the same problem of the `unknown substrate' will present
itself in form of our \acrshort{llm} executing the prompt and inferring what the new -- enhanced --
scenario will look like. But then, I maintain that we still propose a significant value in the
increased awareness \emph{of} the base scenario and its substrate. As we have seen in the
\Nref{sec:results}, the changes made by the \acrshort{llm} typically don't alter the underlying
ontology of the scene.

This touches on a broader topic concerning the \emph{value} of having this knowledge of the
scenario substrate. While this is not the focus of this work, one potential aspect could be a sort
of grounding related to the `sim2real' gap, and the realism of the scene. Let us now delve further
into this.

\section{Realism in the enhanced scenario}

If your task is to `obtain bad driveability in a scenario using \acrlongpl{llm}' in a very general
sense, one can imagine all sorts of creative ways this can be achieved. But in our more narrow scope
of wishing to highlight practical faults in the \acrshort{ads}, we must add another criterium --
realism.

If your scene is bonkers, it will be very easy to get bad driveability. But there is little value
and/or practical applicability in these scenarios. Realism in \acrshort{ads} siimulator scenarios is
a research field in itself with major implications for how scenario-based testing ought to be done.

\citeauthor{RealityBites} have looked into evaluating \acrshort{ads} simulator scenario realism
using \acrshortpl{llm}~\cite[40]{RealityBites}. Note the distinction between this sort of realism in
the `aligns with our understanding of reality'-approach, and the more technical understanding of
realism that posits that the scenario must adhere to the laws of physics, and make sure to not spawn
objects in such a way that they intersect (which would also violate the laws of physics) etc.
\citeauthor{LLMScenarioChang24} also underline the importance of realism, proposing a scoring
function that takes realism into account for evaluating their \acrshort{llm}-generated
\acrshort{ads} simulator scenarios~\cite[6581-6582]{LLMScenarioChang24}\footnote{See also
    \Nref{sec:rwChang24} in \Nref{sec:relatedWork} for more on this work.}.

When modifying an exisiting scenario, the output scenario will in my ways resemble the initial
version. This asserts a certain realism grounded in the initial scenario, assuming that it was
itself generally relalistic. When generating a brand new scenario, it is plausible that we may lose
this connection to reality.

\subsection{Sim 2 real gap}

The so called `sim2real'-gap refers to the distance between a simulation and the real world. We
typically wish to minimize this gap in order to increase the applicability of our simulations to
real world aspects. If there were a \emph{significant} gap between our simulated \acrshortpl{ads}
and the real world, there would be minimal value in performing the simulations and the motivation
for \emph{using} simulator would falter.


% Kan se dette både opp mot sim2real-gap -- \emph{og} ikke

% Ontologi, substrat, arv 

% Modellen kan være trent på lignende scenarios så selv om man genererer vil det
% til dels ha samme substrat 

% Ontologisk summering -> ett scenario som tilføyes informasjon fra flere andre
% scenarios? 

% Perks: Man har mer kontroll over utgangspunktet, så man er viss på at det man
% får ut vil være forankret til den virkeligheten man får presentert i det
% opprinnelige scenarioet. Kontraster til paperet som bruker LLM for å \emph{søke} i
% eksisterende scenario og så bare bruke det som matcher mest, der vil man ikke nødvenidgivs ha
% tilsvarende kontroll på hvilken base man bruker og at denne tilfredsstiller
% relevante krav.

One quite clear example of this, we can find in
\Cref{sec:resultsAccidentScenario} -- the \acrshort{llm} proposes making changes
in such a way that several vehicles are situated on top of bollards. This is
quite questionable. Not only becayse it makes no sense that cars could ever
balance in such a way on the bollards, but also because -- why would the
bollards be \emph{under} vehicles in the first place? It would be far more
realistic to have the bollards be placed \emph{around} the piled-up vehicles
such that the \acrshort{ads} would need to go around them. This would be a more
realistc enhancement, and provide a more valuable insight into the performance
of the \acrshort{ads}. That said, it would probably require more logic in order
to calculate the positions dynamically based on what bollards are located where,
in such a way that base \acrshortpl{llm} typically don't have the possibility of
doing without additional tooling that allows for executing Python code and
determining what these positon should have been.

\section{LLM aspects}

\subsection{Cost/benefits of using \acrshortpl{llm}}
% \section{Environmental concerns}

\acrshortpl{llm} consume significant resources (\Cref{sec:llmProblems}). In order to justify their
adoptation for \acrshort{ads} scenario enhancement, we should evaluate wheter the pros outweigh the
cons. While this remain out of scope for the current thesis and while we demonstrated promising
results in \Cref{sec:results}, it is important to keep in mind the environmental cost of using the
\acrshortpl{llm} for this purpose. How good should the results need to be in order to justify using
\acrshortpl{llm}?

% TODO: Dette virker ganske malplassert. Hvorfor skal det ligge her og ikke **I** Future work?
Perhaps future work can look into obtaining similar results using greener strategies.


\subsection{Context size}

By their nature, \acrshortpl{llm} have a set context size. If your prompt exceeds the context size
of the \acrshort{llm}, it will appear to `forget' parts of the input. This poses a potential problem
for our scenarios. As the scenario complexity increases, so will the length of the prompt. There
will ineveatibly come a point where the \acrshort{llm} can no longer take the entire scenario into
account. One potential way of remedying this could perhaps be to only include a subset of the
scenario definition file into the prompt, so that it will consume fewer tokens.

Futhermore, certain scenarios sometimes exist in one file. I.e., we use a single file to represent
several scenarios. This can potentially cause issues for the \acrshort{llm} in that it will need to
know which scenario it is to focus on. This has, however, not caused significant issues for this project.

\subsection{Alignment}

AI alignment is a topic in of itself. How can we know that goals of the AI are the same goals as we
have?

\subsection{Bias}

One of the motivations for performing this project, was to cirucmvent potential bias with the
scientists that manually create scenarios. But it's worth noting that this \hefe~scenario
modification approach is still vulnerable to bias based on the \acrshort{llm} training data.

Furthermore, how can we be sure that the enhanced scenarios will reflect the diverse set of possible
driving situations? While we indeed know that we \emph{will} get scenarios with decreased
driveability, we have no measure of these scenario's relevance for global communities where traffic
standards vary.

Perhaps the \acrshort{llm} has some hidden bias preventing it from allowing us to exploit certain
aspects of the scenes?

% Når LLMen endrer ting på andre siden av mapet osv som bare ikke påvirker ego vehicle overhode
\subsection{What is being changed in the scenario?}

Scenarios center on the ego vehicle. But what if the \acrshort{llm} changes parts of the scene that
don't affect the ego? In these cases, all metrics should be more or less the same\footnote{Keep in
    mind that the \acrshort{ads} motion planners are not deterministic, and as such the metrics will typically
    not be identical.}. But then ther is no point in having done the modification. This has also not
been a problem for these experiments.

\section{Scenario formats}
% \section{Python / OpenScenario / DSI}

This project utilises scenario in the Python format. Scenarios can also be represented by other
formats as we saw in \Cref{sec:adsScenarioFormats}, the principal option being OpenSCENARIO.
OpenSCENARIO exists both as an XML-based format, and as a \acrfull{dsl}. These \num{3} options all
have their pros and cons. Let us discuss some of these.

It's worth noting that the proposed solution can trivially be adapted to work with other formats.

\subsection{Python}

One major advantage with using Python formats is that most \acrshortpl{llm} have significant
familiariy with it due to the significant extant Python training data. But this is a double-edged
sword -- Python has been around for a significant amount of time, and has undergone significant
changes. Thus, when prompting the \acrshort{llm} to enhance a Python scenario, there arises several
potential issues: \begin{itemize}
    \item language syntax
    \item depenency versions.
\end{itemize}

As outlined in the \Nref{sec:results}, the \acrshortpl{llm} are prone to hallucinating in a way tha
causes issues for executing the enhanced scenarios. But what \emph{is} our evidence that these
execution problems stem from `true' hallucination and not one of these other sources of potential
error? Perhaps the \acrshort{llm} did the right thing, only to assume some antiguated generation
target (e.g. older version of the Carla simulator with its dependencies, or and older version of the
Python programming language).

In an ideal world, we would want an \acrshort{llm} that was fine tuned for this specific purpose to
optimize its knowledge of the relevant software versions and decrease the likelyhood of it for
whatever reason attempting to use bad versions that cause issues.

\subsection{XML-based OpenSCENARIO}

The XML-based format is probably the most traditional. Due to its significantly less widespread
usage, \acrshortpl{llm} are less likely to have widespread domain knowledge of it. A major advantage
with this approach is that the OpenSCENARIO specification is \emph{made} and is less prone to being
change.d

Something to note is that the Carla simulator only has limited support for the
features of OpenSCENARIO.

\subsection{DSL-based OpenSCENARIO}

Similar to the XML-based format, the scenario \acrshort{dsl} is less widely available in training corpora. However, it also maintains the advantage of being more static and less prone to change.


\begin{lstlisting}[label={lst:OSDSL}, caption={An example of an OpenSCENARIO DSL scenario.}]
import basic.osc

type acceleration is SI(m: 1, s: -2)
unit kphps               of acceleration is SI(m: 1, s: -1, factor: 0.277777778)

scenario top:
    path: Path                      # A path in the map
    path.set_map("Town04")    # specify map to use in this test
    path.path_min_driving_lanes(2)         # Path should have at least two lanes

    ego_vehicle: Model3                # ego car
    npc: Rubicon               # The other car

    event start
    event end
    do serial:
        get_ahead: parallel(duration: 15s):
            ego_vehicle.drive(path) with:
                speed(30kph)
                lane(1, at: start) # left to right: [1..n]
            npc.drive(path) with:
                lane(right_of: ego_vehicle, at: start)
                position(15m, behind: ego_vehicle, at: start)
                position(20m, ahead_of: ego_vehicle, at: end)       

        slow: parallel(duration: 10s):
            ego_vehicle.drive(path)
            npc.drive(path) with:
                speed(10kph)

        accelerate: parallel(duration: 13s):
            ego_vehicle.drive(path)
            npc.drive(path) with:
                acceleration(15kphps)
\end{lstlisting}

Listing~\ref{lst:OSDSL} presents an example of an OpenSCENARIO \acrshort{dsl} scenario, providing
additional context for understanding the concept of the format. The example is copied
from the \href{https://github.com/carla-simulator/scenario_runner/blob/master/srunner/examples/acceleration.osc}{Carla scenario runner examples}.

\section{When is enough -- when is the ADS \emph{safe}?}

An interesting perspective regarding this scenario based testing of
\acrshortpl{ads} is this: How can we ever know that it has been sufficiently
tested and is ready for being deployed on public roads? When investigation this
question, several subproblems arise.

As mentioned in the \Cref{sec:problemDescription}, there are infinetely many
edge cases that are possible for \acrshort{ads} execution. Even if we propose
one billion test cases, and our \acrshort{ads} passes these, how can we know
that it will also pass the hypothetical `one billion and one-th'?

Furthermore, even if it does pass all these tests, how can we be sure that it
acts in an ethical manner? There are several possible courses of action that it
can take in various situations.