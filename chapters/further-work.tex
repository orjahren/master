\chapter{Future work}\label{chp:furtherWork}

\epigraph{Whenever a theory appears to you as the only possible one, take this as a sign that you have neither understood the theory nor the problem which it was intended to solve.}{Popper}

This penultimate chapter proposes directions for further research aimed at
solving the same problem in a similar 
manner, based on \begin{inparaenum}
    \item the experiences gained during this work, and
    \item approaches that there was not time to go through with.
\end{inparaenum}

\section{LLM oriented aspects}\label{sec:fwLlm}

\acrshortpl{llm} are naturally central for a work like this. The following
section reviews various \acrshort{llm}-related aspects that may stand to
serve the goal of employing \acrshortpl{llm} for decreasing driveability in
\acrshort{ads} simulator scenarios. The proposed strategies stem from the
experiences gained while performing the experiments and analysing the results,
and they relate both \begin{inparaenum}
    \item  to the actual \acrshortpl{llm},
    \item  how the \acrshort{llm} can be exploited with prompts, and 
    \item recent techniques that aim to reduce problems with \acrshort{llm} hallucinations.
\end{inparaenum}

\subsection{Prompting strategies}

For a work like this, the importance of the \emph{prompts} cannot be understated. Further work may
stand to benefit from exploring different prompting strategies. See for
example~\cite{girayPromptEngineering23}. Prompting techniques for persuading \acrshortpl{llm} to
perform actions they may find objectionable are presented by \citeauthor{meincke2025overtale} and
shown to bear fruitful results~\cite[1]{meincke2025overtale}. This might stand to remedy potential
alignment and bias issues (see \cref{sec:discussionLlmAspects}).

\subsection{Experimenting with other models}

\acrshortpl{llm} typically have different properties. Further work could evaluate different models
on the same experiments. Both for models that already exist today, and models that will exist in the future.

\subsection{Fine-tuned model}

This work has exclusively used generalist \acrshortpl{llm}. Given the necessary resources, one could
fine-tune a model specifically for this purpose, using scenario definitions as training data.

\subsection{Temperature configurations}
As a consequence of how \acrshortpl{llm} work internally, they have a \emph{temperature} that
affects their output. For the same reasons that further work can explore the applicability of other
\acrshortpl{llm}, testing the same \acrshortpl{llm} with different temperature configurations may
also yield an interesting insight into their applicability for decreasing driveability in
\acrshort{ads} simulator scenarios.

Keep in mind how hallucination was a significant factor when undertaking the experimentation (see
\cref{sec:resultsHallucinations}). In order to decrease the hallucinations, one would assume a lower
temperature \acrshort{llm} to be more relevant.

\subsection{Retrieval-augmented generation (RAG)}

\acrfull{rag} is a novel technique that inserts pieces of relevant external knowledge into an
\acrshort{llm}'s context~\cite[88-89]{llmSurvey}. It would be interesting to employ such a strategy
for this work. By adding existing scenarios to the \acrshort{llm}'s context, it would be able to
leverage these as a source of legal ways of modifying scenarios in a way that we would know to be
both \begin{inparaenum}
    \item legal, and
    \item supported by the simulator.
\end{inparaenum} Perhaps this could provide better results with less hallucinations?

\subsection{Model context protocol (MCP)}

Recently, a technique called \acrfull{mcp} has been proposed\footnote{See e.g.
    \url{https://www.anthropic.com/news/model-context-protocol}}, that allows for defining a specific
interface for \acrshortpl{llm} to interact with. Further work could construct such an interface for
modifying scenarios, clearly demarcating what the \acrshort{llm} can and cannot do.

In a somewhat similar fashion to \acrshort{rag}, albeit with more strict limitations imposed on the
\acrshort{llm}, this could allow us to be more confident in knowing that it would perform legal actions.

\subsection{Tool manipulation}

Tool manipulation is a technique for granting \acrshortpl{llm} access to
\emph{tools}~\cite[62]{llmSurvey}, e.g. the ability to call certain functions. Somewhat similar to
\acrshort{mcp}, but less general -- not standardized. For the same reasons that \acrshort{mcp} can
be used, tool manipulation can be used. Define functions to add objects at locations that the script
determines to be legal with regard to the laws of physics and the placement of other objects, and
the \acrshort{llm} will then be able to utilise this function as a black-box utility, without
having to concern itself with the ontological issues of object spawning.

\section{Implementation oriented aspects}

This section proposes methods for enhancing the existing implementation (see
\cref{chp:solutionProposal}) with additional features or better techniques, motivating why the
additional features would be useful.

\subsection{Static analysis of the enhanced scenario}

As of now, the principal way of determining whether a modified scenario is good and runnable, is by
simply attempting to run it and see if it works. This is not ideal as it wastes lot of time. Even
more time is wasted if the scenario causes the Carla simulator to crash\footnote{Getting it back
    online is a quite involved and slow-to-complete process.}.

By employing techniques from the realm of programming language compilers, we could perform a static
analysis of the output scenario and evaluate whether it adheres to the specification. This would
allow us to filter out bad apples before attempting to run them, circumventing the need for wasting
time.
For example, we \emph{know} that we should be able to \emph{parse} the scenario. If parsing
fails, there is no need of sending the scenario to the simulation running pipeline.

An advanced version of this could also look into the proposed spawn locations of items in the
scenario\footnote{That may overlap\ldots}, making sure that they don't intersect and adhere to the
relevant laws of physics. Perhaps this could also serve to yield some insight into the realism of
the scenario.

\subsection{GUI visualisation}

Scenarios in \acrshort{ads} simulators are inherently \emph{visual}. This can be leveraged to create
a tool for rendering visual representations of the scenarios in a \acrfull{gui}. The \acrshort{gui}
tool could show side-by-side the base scenario and its enhanced counterpart, highlighting what has
been modified.
This will be more user friendly, and it will more clearly underline the motivation behind \emph{why}
the enhanced scenario will have worsened driveability compared to the base scenario.
Perhaps one could even \emph{execute} the scenarios side-by-side, showing live metrics to the user.

\subsection{Other datasets}

For this thesis, a selection of quite basic scenarios from the Carla scenario runner example
scenario collection was used. However, the concept should work for \emph{any} Carla-compatible
\acrshort{ads} scenarios. Several such options are presented in \Nref{sec:relatedWork}.

\subsection{More diverse scenarios}
%CULRUTRAL ASPECTS OF THE SCENE
The base scenarios used for this work are generally western in nature. Global \acrshort{ads} adaptation
requires universal testing on a broad range of scenarios with various traffic conditions and cultural
aspects. Future work may stand to benefit from employ this \acrshort{llm}-based approach in order
to obtain a greater number of scenarios from less widely available scenarios from regions where
relevant data is less prolific and existing scenarios are scarce.
% TODO: Dette ble en veldig rar setning^

\subsection{Efficiency}

Due to the somewhat `proof of concept' nature of the current \hefe{}
implementation, performance and efficiency has not been afforded significant
attention. There are however some quite low-hanging fruits that stand to be
exploited. This subsection outlines some of these.

\subsubsection{Concurrency of scenario processing}

\acrshort{ads} scenarios are independent of each other. This means that our problem is
\textit{embarrassingly
parallelizable}\footnote{\url{https://en.wikipedia.org/wiki/Embarrassingly_parallel}}
and we can trivially process several test cases in parallel. Both performing the
\acrshort{llm} enhancement, and executing them on Carla, can be done regardless
of all the other scenarios. 

\subsubsection{Python-specific enhancements}

The Python-based \hefe~implementation can be optimized using \acrfull{jit}
compilers such as Numba~\cite{numba}, which can speed up our execution times.
Libraries such as Joblib provide Python with plug-and-play meomization, which
will allow us to re-use values that have already been computed, saving time and
energy.


\subsection{Domain specific file format}

These experiments have been performed using only default file-formats, relying on manual labour to
track \begin{inparaenum}
    \item what scenario x' is the modified version of what scenario x,
    \item what prompt was used,
    \item what\footnote{If any \ldots} manual changes was needed for executing,
\end{inparaenum} etc.

The scientific community could stand to benefit from developing a
domain-specific file format for this specific purpose. 
E.g. a JSON-based file format that contained a copy of the \begin{inparaenum}
    \item base scenario, the
    \item enhanced scenario,
    \item what prompt was used,
    \item the diff,
    \item timestamp,
\end{inparaenum} etc. Perhaps even what metrics were achieved while executing the 2 forms of the
scenario. It would however not be optimal to track several copies of the same base scenario -- there
would be a lot of duplicates, and they would all have virtually the same metrics.

This could all be achieved by wrapping a JSON file. Perhaps we could zip or encode it to make it
less prone to manual modification\footnote{Which would invalidate its content and potentially serve
    to spoof the results.}.

\subsection{More stable Carla setup}

As outlined in \Cref{chp:results}, the Carla simulator just does not work with certain scenarios.
Future work could stand to benefit from having the simulator be more stable. That would allow from
experimenting with a more diverse array of base scenarios, which would stand expand the range of
potential scenarios we would be able to challenge the \acrshort{ads} with.

\citeauthor{jia2024bench} posit that the Nvidia GPU driver version of the host machine is relevant
for the Carla stability, finding that version \num{470} supposedly is optimal and that version
\num{550}\footnote{And presumably following versions.} `has lots of bugs'\footnote{
    See \url{https://github.com/Thinklab-SJTU/Bench2Drive/tree/main?tab=readme-ov-file\#deal-with-carla},
    from the repo of their paper \cite{jia2024bench}.}.
The experiments of this project have been done using version \num{580}.

A possible alternate strategy could be to undertake a similar work within the CommonRoad framework,
bypassing Carla altogether\footnote{See e.g. \url{https://commonroad.in.tum.de/tools/drivability-checker}.}.

\newpage % Legger inn ny side siden den uansett konsummeres og det ser bedre ut 

\subsection{More scientific way of evaluating a result}\label{sec:fwDetermine}

As of now, the process of evaluating an experiment as failed or succeeded (see
\Nref{sec:experimentsMetrics}), is not that scientific. It works sufficiently for our purposes, but
there is a lot to be gained by formalizing the process.

Further work could look into defining mathematical properties for what qualifies as a `meaningfully
decreased driveability'. \citeauthor{adsQualityMetrics21} propose several evaluation
criteria~\cite[196]{adsQualityMetrics21}. One typical example could be to look at whether the jerk
exceeded a certain threshold during scenario execution -- but even then, we need to define what
this threshold should be. Several heuristics may be applicable. And it really isn't the case that
`more jerk' indicates the presence of a result, as maintaining \emph{the same} jerk could be equally
indicative of a result. This has to be tailored to the specific scene, in light of what the
\acrshort{llm} has changed. In certain cases it would be good to see an increased jerk, and in other
cases we would want it to remain the same. The reason for this is that if the \acrshort{llm} changes
something on the other side of the map that doesn't affect the \acrshort{ads} ego (c.f.
\Cref{sec:whatIsBeingChanged}), we should not count it as a failure for the \acrshort{ads} if it
fails to obtain more jerk -- it should be counted as a failure for the \acrshort{llm}.

This is a \emph{hard} question and has been one of the major recurring challenges while working on
this project.